<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Loki Comparators - LokiDB</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../css/codemirror/codemirror.css" rel="stylesheet" />
  <link href="../css/codemirror/foldgutter.css" rel="stylesheet" />
  <link href="../css/javascript_editor.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Loki Comparators";
    var mkdocs_page_input_path = "comparators.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> LokiDB</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Loki Comparators</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#why-would-i-need-more-than-the-default-js-comparator">Why would I need more than the default "js" comparator?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#custom-user-defined-comparators">Custom, user-defined comparators</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#summary">Summary</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../operator_packages/">LokiOperatorPackages</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../ranged_indexes/">LokiDB Ranged Indexes</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">LokiDB</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Loki Comparators</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/LokiJS-Forge/LokiDB/edit/master/docs/comparators.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="loki-comparators">Loki Comparators</h1>
<blockquote>
<p>Comparators (in javascript and loki) are functions which accept two values and return :
- 0 : if the first and second are considered equal
- -1 : if the first is less than the second
- 1 : if the first is greater than the second</p>
</blockquote>
<h2 id="overview">Overview</h2>
<p>Since comparators now play a important role in customizing and fine-tuning LokiDB, this page will attempt to summarize the reasoning behind this increased structuring. </p>
<p>In the previous version of LokiDB (LokiJS), various components such as find ops, BinaryIndices and sorting shared a common set of helper functions serving as a common comparator. This arbitrary co-mingling inadvertently became standard as it would have been too much of a breaking change to decouple that later on (although some attempts to provide additional options were later added).</p>
<p>In LokiDB, to support decoupling these various components, we have established a 'ComparatorMap' which is a collection of named comparator functions.</p>
<p>LokiDB utilizes these comparators for : 
- Unindexed sorting
- Used with <a href="../ranged_indexes/">RangedIndexes</a> (such as our provided "avl" index) for higher performance filtering.
- Can be optionally leveraged within unindexed find() operations (like $eq, $gt, $gte, $lt, $lte, $bewtween) when using our new 'ComparatorOperatorPackage' (See <a href="./operators.md">operators.md</a>).  </p>
<h2 id="why-would-i-need-more-than-the-default-js-comparator">Why would I need more than the default "js" comparator?</h2>
<p>Out of the box, LokiDB provides some base comparators :
- "js" (default) : fastest, pure javascript with strict equality for $eq
- "abstract-js": fast, pure javascript with loose equality
- "abstract-date": can be used for comparing dates in various formats
- "loki" comparators: slower, safer for mixed datatypes in ranged indexes.  This more closely resembles the comparator functionality which existed in LokiJS.
- (possible additon) "string-insensitive" : could be used for comparing, sorting strings with case insensitivity.</p>
<p>Individual comparators can be selected from the above to be used for indexing, sorting, or filtering... whichever makes the most sense from a performance, functional, or type safety perspective.</p>
<h2 id="custom-user-defined-comparators">Custom, user-defined comparators</h2>
<p>If the various 'built-in' comparators don't fit a particular use case,  users can define their own comparator functions and add to (or override) comparators within the ComparatorMap.  They can then be leveraged in various places for sorting, indexing, filtering.  This configuration is done when instancing your Loki database instance, within the constructor.</p>
<p>An Example of this might look like the following : </p>
<pre><code class="javascript">// define comparator function
let myComparator = (a, b) =&gt; {
   if (a === b) return 0;
   if (a &gt; b) return 1;
   return -1;
}

// pass in any number of comparators to add to or override those aleady registered
let db = new Loki(&quot;test.db&quot;, {
   comparatorMap: {
      &quot;MyComparator&quot;: myComparator
   }
});
</code></pre>

<p>Having configured the above example, you might use them within collections, such as this simplesort() operation :</p>
<pre><code class="javascript">// when instancing a new collection, you can specify this to override the default &quot;js&quot; unindexedSortComparator.
let coll = db.addCollection(&quot;users&quot;, {
   unindexedSortComparator: &quot;MyComparator&quot;
});

coll.insert(someDocuments);

// this will use the currently configured default unindexedSortComparator
let result = coll.simplesort(&quot;name&quot;);

// simplesort also allows you to override the default comparator in options
let reversed = coll.simplesort(&quot;name&quot;, { 
   desc: true,
   unindexedSortComparator: &quot;string-insensitive&quot; 
});

</code></pre>

<p>Other uses for utilizing the named comparators include defining your own <a href="./operators.md">LokiOperatorPackage</a> and using within <a href="../ranged_indexes/">RangedIndexes</a>.  Those topics will go into details and give code samples within their respective pages.</p>
<p>Transform steps such as 'find' filtering and simplesort steps will also be able to leverage these, either explicitly or via options.</p>
<h2 id="summary">Summary</h2>
<p>In the future, anywhere where these comparators can be leveraged, we will likely do so... to allow the ability for the user to customize and optimize LokiDB to best work with their data.</p>
<p>Registration of user defined comparators needs to done every time you re-instance the database.  Only the names of the comparators are persisted within your saved/serialized database.  While this is an additional responsibility, it also allows experimentation to determine the performance (for tuning).</p>
<p><strong><em>Warning</em></strong> : If a user defined comparator is paired with a range index, it is important that the comparator not change over time.  Ranged indexes (typically) persist themselves as ordered represenations and future relative calculations of re-organization across inserts, updates, and removes depend on consistent comparison results.</p>
<p>If your custom comparator is <strong><em>not</em></strong> used by a ranged index, you are free to experiment and refine the comparison results over time to reflect and refine the functional output of various LokiDB tasks. </p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../operator_packages/" class="btn btn-neutral float-right" title="LokiOperatorPackages">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2017</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/LokiJS-Forge/LokiDB/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../operator_packages/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../js/gitter.js" defer></script>
      <script src="../js/javascript_editor.js" defer></script>
      <script src="../js/codemirror/lib/codemirror.js" defer></script>
      <script src="../js/codemirror/addon/fold/brace-fold.js" defer></script>
      <script src="../js/codemirror/addon/fold/foldcode.js" defer></script>
      <script src="../js/codemirror/addon/fold/foldgutter.js" defer></script>
      <script src="../js/codemirror/addon/edit/matchbrackets.js" defer></script>
      <script src="../js/codemirror/mode/javascript/javascript.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
